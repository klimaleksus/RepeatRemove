// /nodejs/repeat_remove.js
"use strict";!function(){var e,r,t=!0,n=!1,a="NodeJS";if("undefined"==typeof module||module.parent)t=!1,self!=self.window?(a="WebWorkers",self.importScripts("./buffer.js"),self.Buffer=self.buffer.Buffer,u()):self.window&&(n=!0,a="Browser",window.Buffer=window.buffer.Buffer,u());else{e=require("fs"),require("util");for(var i,s=[],o=1;o<process.argv.length;o++)s.push(process.argv[o]);i=s.length,process.exitCode=u()(i,s)}function u(){if(t){u=function(r,t,n,a){try{return e.readSync(a,r,0,t*n,null)/t|0}catch(e){return 0}},b=function(r,t,n,a){try{return e.writeSync(a,r,0,t*n,null)/t|0}catch(e){return 0}},h=function(r,t){try{return e.openSync(r,t)}catch(e){return null}};var i=function(r){try{return e.closeSync(r),0}catch(e){return-1}};d=function(r){try{return e.unlinkSync(r),0}catch(e){return 1}},y=function(r,t){try{return e.renameSync(r,t),0}catch(e){return 1}},v=function(e){try{return Buffer.allocUnsafeSlow(e)}catch(e){return null}},p=0,s=1,m=2,o=function(){var e=Array.prototype.slice.call(arguments),r=e.shift(),t=w.apply(null,e),n=Buffer.from(t,"utf8");return b(n,1,n.length,r)}}else var s,o=function(e){var r=Array.prototype.slice.call(arguments);r.shift();e(w.apply(null,r))},u=function(e,r,t,n){n=p;for(var a=Math.min(n.byteLength,r*t),i=new Uint8Array(n),s=0;s<a;s++)e[s]=i[s];return p=n.slice(a),a/r|0},f=function(e,r){(!r||r<0||r>p.byteLength)&&(r=p.byteLength);try{e.buffer=Buffer.from(p,p.byteOffset,r),e.bytes=r}catch(r){e.bytes=0,e.buffer=null}},l=0,c=[],h=function(e,r){if(l>2)return null;if(!l++)return p;var t={blob:new Blob([""],{type:"audio/wav"}),size:0,name:e};return c.push(t),t},b=function(e,r,t,n){var a=Math.min(e.byteLength,r*t);return n.blob=new Blob([n.blob,e.slice(0,a)],{type:"audio/wav"}),n.size+=a,a/r|0},d=function(e){return 1},y=function(e){return 1},v=function(e){try{return Buffer.alloc(e)}catch(e){return null}},p=null,m=s=function(e){r({action:"log",text:e})};function w(){var e=Array.prototype.slice.call(arguments),r=""+e.shift(),t=0;return r.replace(/%./g,function(r){if(t>=e.length)return r;switch(r){case"%d":return+e[t++];case"%s":return""+e[t++];case"%%":return"%";default:return r}})}var g=function(e,r,t){return r.copy(e,0,0,t),e},_=o.bind(null,s),L=function(e){},k=!1;if(n&&window.Promise){function L(e){if(k)throw"abort";return new Promise(function(e){setTimeout(e)})}L="async"}var z=1e3;function E(){return Date.now()}function A(e,r,t,n){var a=""+e;if(a.length>=r)return a;var i=t.repeat(r-a.length);return n?a+i:i+a}var I=!0;try{var O=new ArrayBuffer(2),R=new Uint16Array(O,0,1),S=new Uint8Array(O,0,2);S[0]=0,R[0]=1,S[0]&&(I=!1)}catch(e){}function F(e,r,t){for(var n,a=0;t>0&&!((n=u(r,1,t,e))<0)&&(n||1==(n=u(r,1,1,e)));)a+=n,r=r.slice(n),t-=n;return a}function B(e,r,t){for(var n,a=0;t>0&&!((n=b(r,1,t,e))<0)&&(n||1==(n=b(r,1,1,e)));)a+=n,r=r.slice(n),t-=n;return a}function M(e,r){var t=void 0===r;switch(e){case"riff_header":return t?this.slice(0).toString("binary",0,4):this.slice(0).write(r,0,4,"binary");case"wav_size":return t?this.readInt32LE(4):this.writeInt32LE(r,4);case"wave_header":return t?this.slice(8).toString("binary",0,4):this.slice(8).write(r,0,4,"binary");case"fmt_header":return t?this.slice(12).toString("binary",0,4):this.slice(12).write(r,0,4,"binary");case"fmt_chunk_size":return t?this.readInt32LE(16):this.writeInt32LE(r,16);case"audio_format":return t?this.readInt16LE(20):this.writeInt16LE(r,20);case"num_channels":return t?this.readInt16LE(22):this.writeInt16LE(r,22);case"sample_rate":return t?this.readInt32LE(24):this.writeInt32LE(r,24);case"byte_rate":return t?this.readInt32LE(28):this.writeInt32LE(r,28);case"sample_alignment":return t?this.readInt16LE(32):this.writeInt16LE(r,32);case"bit_depth":return t?this.readInt16LE(34):this.writeInt16LE(r,34);case"data_header":return t?this.slice(36).toString("binary",0,4):this.slice(36).write(r,0,4,"binary");case"data_bytes":return t?this.readInt32LE(40):this.writeInt32LE(r,40)}return null}function U(e){switch(e){case"riff_header":return 0;case"wav_size":return 4;case"wave_header":return 8;case"fmt_header":return 12;case"fmt_chunk_size":return 16;case"audio_format":return 20;case"num_channels":return 22;case"sample_rate":return 24;case"byte_rate":return 28;case"sample_alignment":return 32;case"bit_depth":return 34;case"data_header":return 36;case"data_bytes":return 40}return-1}function x(e){switch(e){case"wave_header":return 44;case"uint":case"float":return 4}return 0}function T(e,r,t,n){var a,i=x("wave_header")-(t.byteOffset-r.byteOffset);return!!(a=v(n))&&(F(e,a,n)!=n?(a=null,!1):(n<i?(g(t,t.slice(n),i-n),g(t.slice(i-n),a,n)):g(t,a.slice(n-i),i),a=null,!0))}function W(e,r,t,n,a){var i={};return!((e=M.bind(e))("wav_size")>0&&e("data_bytes")>0&&e("wav_size")<e("data_bytes"))&&(16==e("fmt_chunk_size")&&(1==e("audio_format")&&((1==e("num_channels")||2==e("num_channels"))&&((8==e("bit_depth")||16==e("bit_depth"))&&(r&&(i.is_stereo=2==e("num_channels")),t&&(i.is_16bit=16==e("bit_depth")),n&&(i.sample_rate=e("sample_rate")),a&&(e("data_bytes")>0&&e("data_bytes")<2147483647?i.data_bytes=e("data_bytes"):i.data_bytes=-1),i)))))}function q(e,r){var t=e/r|0,n=e%r*1/r*1e5|0;return w("%d:%s.%s",t/60|0,A(t=t%60|0,2,"0",!1),A(n,5,"0",!1))}function P(e,r,n){var a,i,s,u,l=W(e.header,!0,!0,!0,!0);if(!l)return n&&(o(n,"Your WAVE is not supported!\n"),L(n)),!1;if(i=l.is_stereo,s=l.is_16bit,e.rate=l.sample_rate,a=l.data_bytes,n&&(o(n,"WAVE: %d bit %s (%d Hz),",s?16:8,i?"stereo":"mono",e.rate),L(n)),a>0){if(t){if(e.buffer=v(a),!e.buffer)return n&&(o(n,"\nOut of memory! (Need %d Mb)\n",a>>20),L(n)),!1;e.bytes=F(r,e.buffer,a)}else f(e,a);e.bytes!=a&&n&&(o(n,"\nProbably a read error (size should be %d)...\n",a),L(n))}else{if(n&&(o(n,"\nBad size in RIFF header..."),L(n)),t){var c=function(e,r){var t,n,a,i,s,o,u,f,l={};for((t=[]).length=256,n=0,i=0;i<256&&(t[i]=v(8388608),t[i])&&(s=8388608,n+=o=F(e,t[i],s),8388608==o);i++);if(!(u=v(n))){for(l.buffer=null,i=0;i<256&&t[i];i++)t[i]=null;return t=null,l.result=-n,l}for(l.buffer=u,a=n,i=0;i<256&&(f=t[i]);i++)s=8388608,n<8388608&&(s=n),g(u,f,s),u=u.slice(s),t[i]=null,n-=s;return t=null,l.result=a,l}(r,e.buffer);e.bytes=c.result,e.buffer=c.buffer}else f(e);if(e.bytes<0)return n&&(o(n,"\nOut of memory! (Need 2*%d Mb)\n",-e.bytes),L(n)),!1}(function(e){var r,t,n=e.bytes;if(n<2048)return!1;for(n&=-2,n-=12,r=e.buffer,t=0;t<1024;t+=2){if("RIFF"==r.slice(n).toString("binary",0,4)&&"WAVE"==r.slice(n+8).toString("binary",0,4))return e.bytes=n,!0;n-=2}return!1})(e)&&n&&(o(n,"\nIgnored extra RIFF tail..."),L(n));var h=e.buffer;return i?s?(e.bytes=-4&e.bytes,e.length=e.bytes>>2,e.shift=2,e.array=new Int16Array(h.buffer,h.byteOffset,h.byteLength/2),e.based=new Uint32Array(h.buffer,h.byteOffset,h.byteLength/4)):(e.bytes=-2&e.bytes,e.length=e.bytes>>1,e.shift=1,e.array=new Uint8Array(h.buffer,h.byteOffset,h.byteLength),e.based=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/2)):s?(e.bytes=-2&e.bytes,e.length=e.bytes>>1,e.shift=5,e.array=new Int16Array(h.buffer,h.byteOffset,h.byteLength/2),e.based=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/2)):(e.length=e.bytes,e.shift=0,e.array=new Uint8Array(h.buffer,h.byteOffset,h.byteLength),e.based=new Uint8Array(h.buffer,h.byteOffset,h.byteLength)),u=q(e.length,e.rate),n&&(o(n," bytes: %d, length: %s\n",e.bytes,u),L(n)),!0}function V(e,r,t,n){var a=Buffer.alloc(4);a[0]=0;var i,s=3&e.shift;return!((i=function(e,r){var t,n=W(e,!0,!0,null,null);return n?(t=r,n.is_stereo&&(t<<=1),n.is_16bit&&(t<<=1),(e=M.bind(e))("data_bytes",t),e("wav_size",t+x("wave_header")-8),1&e("wav_size")&&e("wav_size",e("wav_size")+1),t):-1}(e.header,n))<1)&&(n<<=s,t<<=s,B(r,e.header,x("wave_header"))==x("wave_header")&&(B(r,e.buffer.slice(t),n)==n&&(1&i&&B(r,a,1),L(r),!0)))}function C(e,r){var t=e[r<<=1];return((t>0?t/32767:t/32768)+((t=e[r+1])>0?t/32767:t/32768))/2}function N(e,r){var t=e[r<<=1]-128;return((t>0?t/127:t/128)+((t=e[r+1]-128)>0?t/127:t/128))/2}function Y(e,r){var t=e[r];return t>0?t/32767:t/32768}function D(e,r){var t=e[r]-128;return t>0?t/127:t/128}function j(e,r){return r<1?0:100*Math.sqrt(e/r)}function G(e,r,t){var n,a,i;return a=(n=e[r<<=1])>0?n/32767:n/32768,i=(n=e[r+1])>0?n/32767:n/32768,(a-=(n=e[t<<=1])>0?n/32767:n/32768)*a+(i-=(n=e[t+1])>0?n/32767:n/32768)*i}function H(e,r,t){var n,a,i;return a=(n=e[r<<=1]-128)>0?n/127:n/128,i=(n=e[r+1]-128)>0?n/127:n/128,(a-=(n=e[t<<=1]-128)>0?n/127:n/128)*a+(i-=(n=e[t+1]-128)>0?n/127:n/128)*i}function X(e,r,t){var n,a;return a=(n=e[r])>0?n/32767:n/32768,(a-=(n=e[t])>0?n/32767:n/32768)*a}function J(e,r,t){var n,a;return a=(n=e[r]-128)>0?n/127:n/128,(a-=(n=e[t]-128)>0?n/127:n/128)*a}function K(e,r,t,n,a){var i,s,o=e.array,u=0;if(a<1)return u;switch(e.shift){case 0:s=J;break;case 1:s=H;break;case 2:s=G;break;default:s=X}if(n>0)for(i=0;i<n;i+=a)u+=s(o,r+i,t+i);else for(i=0;i>n;i-=a)u+=s(o,r+i,t+i);return u}function Z(e,r){var t,n,a;return(n=(t=e[r<<=1])>0?t/32767:t/32768)*n+(a=(t=e[r+1])>0?t/32767:t/32768)*a}function $(e,r){var t,n,a;return(n=(t=e[r<<=1]-128)>0?t/127:t/128)*n+(a=(t=e[r+1]-128)>0?t/127:t/128)*a}function Q(e,r){var t,n;return(n=(t=e[r])>0?t/32767:t/32768)*n}function ee(e,r){var t,n;return(n=(t=e[r]-128)>0?t/127:t/128)*n}function re(e,r,t){var n,a,i,s=e.array,o=-1,u=0;switch(e.shift){case 0:i=ee;break;case 1:i=$;break;case 2:i=Z;break;default:i=Q}for(a=-r;a<=r;a++)((n=i(s,t+a))<o||o<0)&&(o=n,u=a);return u}function te(e,r,t){for(var n,a=e.length,i=a/1e3|0,s=r,o=r+t,u=0,f=0,l=-1,c=-1;u+f<t;)if(l<0&&s-(u+i)>0&&(l=K(e,s-(u+i),o-(u+i),i,1)),c<0&&o+(f+i)<a&&(c=K(e,s+f,o+f,i,1)),l>=0&&(l<c||c<0))u+=i,l=-1;else{if(!(c>=0))break;f+=i,c=-1}return(n=u+f-t)<2?s-u:s-(u-(n>>1))}function ne(e,r,t,n,a){var i=e.length,s=t-r,o=!0;return a&&(!function(e,r,t){var n,a,i,s,o,u,f=e.based;if(!(t<2))if(i=r,s=r+(n=t>>1),1&t){for(u=f[t-1],a=0;a<n;a++)o=f[i],f[i]=f[s],f[s]=u,u=o,i++,s++;f[t-1]=u}else for(a=0;a<n;a++)o=f[i],f[i]=f[s],f[s]=o,i++,s++}(e,r,s),V(e,a,r,s)||(o=!1)),n&&(!function(e,r,t,n){var a=3&e.shift;r<<=a,t<<=a,n<<=a,g(e.buffer.slice(n),e.buffer.slice(r),t)}(e,t,i-t,r),V(e,n,0,i-s)||(o=!1)),o}function ae(e,r,t,n,a,i,s){var o,u,f,l,c,h,b,d,y,v,p=e.length,m=a,w=-1,g=0;for(f=p/10|0,s?(u=r-((p/5|0)-(p/1e3|0)),(o=r-((p/2|0)+(p/1e3|0)))-f<0&&(o=f),f=-f):(o=r+((p/5|0)-(p/1e3|0)),(u=r+((p/2|0)+(p/1e3|0)))+f>p&&(u=p-f)),v=o;v<u;v++)m[g++]=v;for(y=n-1;g>1;){for(d=t[y],c=0,v=0;v<g;v++)c+=l=K(e,r,m[v],f,d),(l<w||!v)&&(w=l),i[v]=l;for(h=w+.75*(c/g-w),b=0,v=0;v<g;v++)i[v]<=h&&(m[b++]=m[v]);if(g=b,!y)break;y>>=1}return s?r-m[0]:m[0]-r}function ie(e,r,t){var n;for(n=e[0].from;n>0;n--)if(e[n].from==r){r=-1;break}for(r>=0&&(e[++e[0].from].from=r),n=e[0].size;n>0;n--)if(e[n].size==t){t=-1;break}t>=0&&(e[++e[0].size].size=t)}function se(e,r,t,n,i){var s,u,f,l,c,h,b,d,y,v,p,m,w=e.length,g=w/8|0,_=w/2|0,k=w/16|0,z=w/2|0,E=[];E.length=16;for(var I=0;I<E.length;I++)E[I]={from:0,size:0};for(p=(m=z)<2?2:1.25506*m/Math.log(m)+1|0,d=new Uint32Array(z),y=new Float32Array(z),v=new Uint32Array(p),b=x("uint")*z+x("float")*z+x("uint")*p+e.bytes,p=function(e,r,t,n){var a,i,s,o,u;if(r<1||t<1)return 0;if(u=1,s=0,n){if(e[s++]=1,1==r||1==t)return 1;u=2}for(e[s++]=2,a=3;a<=t&&s<r;a+=2){for(e[s]=a,o=0|Math.sqrt(a),i=u;i<s&&e[i]<=o;i++)if(a%e[i]==0){s--;break}s++}return s}(v,z,w/40|0,!0),i&&(o(i,"Total samples: %d, memory used: %d Mb, environment: %s\n",w,1*b/1048576+.5|0,a),L(i)),h=0,f=g;f<=_;f+=k)for(c=0;c<=1;c++)h++,u=ae(e,s=(l=c?w-f:f)+re(e,w/2e3|0,l),v,p,d,y,c),c&&(s-=u),ie(E,te(e,s,u)+(u>>1),u),i&&(o(i,"%s%s",A(u,10," ",!1),h%7?" ":"\n"),L(i));return v=null,d=null,y=null,function(e,r,t,n,a,i){var s,u,f,l,c,h,b,d,y,v,p={},m=r[0].from,w=r[0].size,g=e.length/2e3|0,_=0,k=0;for(s=1;s<=m;s++)r[s].from+=re(e,g,r[s].from);for(s=1;s<=m;s++)for(u=s+1;u<=m;u++)r[s].from>r[u].from&&(f=r[s].from,r[s].from=r[u].from,r[u].from=f);for(s=1;s<=w;s++)for(u=s+1;u<=w;u++)r[s].size>r[u].size&&(f=r[s].size,r[s].size=r[u].size,r[u].size=f);for(u=1,s=2;s<=m;s++)r[s].from!=r[u].from&&(r[++u].from=r[s].from);for(m=u,r[0].from=u,u=1,s=2;s<=w;s++)r[s].size!=r[u].size&&(r[++u].size=r[s].size);for(w=u,r[0].size=u,i&&(o(i,"Refining: %s x %s...  ",A(m,2," ",!1),A(w,2," ",!0)),L(i)),p.find=m+w,d=-1,u=1;u<=w;u++)for(i&&L(i),l=(h=r[u].size)/3|0,s=1;s<=m;s++)(c=r[s].from)-l<0||c+h+l>=e.length||((b=j(b=K(e,c-l,c+h-l,2*l,1),2*l))<d||d<0)&&(_=c,k=h,d=b);for(i&&(o(i,"START: %s ",A(_,10," ",!0)),L(i)),d=-1,s=-10;s<=10;s++)v=(c=_)+(h=k+s)+(l=(h>>1)-20),(y=c-l)<0?y=0:v>=e.length&&(y-=v+1-e.length),((b=j(b=K(e,y,y+h,2*l,1),2*l))<d||d<0)&&(d=b,p.begin=c,p.end=c+h);return i&&(o(i,"END: %s SIZE: %s\n",A(p.end,10," ",!0),A(p.end-p.begin,10," ",!0)),L(i)),p.result=d,p}(e,E,0,0,0,i)}function oe(e,r,t,n){var a,i;-1===e&&(e=p);var s,u,f,l,c,h,b=!0,d=!0,y={header:Buffer.alloc(x("wave_header")),buffer:null,length:0,bytes:0,shift:0,rate:0,array:null,based:null},v=!0,m=!0;return function(e,r){var t;if(F(r,e,x("wave_header"))!=x("wave_header"))return!1;var n=e;if("RIFF"!=(e=M.bind(e))("riff_header"))return!1;if("WAVE"!=e("wave_header"))return!1;for(;"fmt "!=e("fmt_header");){if((t=e("fmt_chunk_size"))<0||t>1048576)return!1;if(1&t&&t++,t+=8,!T(r,n,n.slice(U("fmt_header")),t))return!1}for(;"data"!=e("data_header");){if((t=e("data_bytes"))<0||t>1048576)return!1;if(1&t&&t++,t+=8,!T(r,n,n.slice(U("data_header")),t))return!1}return!0}(y.header,e)?!!P(y,e,n)&&(y.length<5e3?(n&&(o(n,"The file is too small!\n"),L(n)),!1):(n&&function(e,r){var t,n=[];n.length=1248;for(var a=0;a<n.length;a++)n[a]=0;var i,s,u,f,l,c,h,b,d,y,v=e.shift,p=e.array;switch(v){case 0:y=D;break;case 1:y=N;break;case 2:y=C;break;default:y=Y}for(i=0;i<78;i++){for(h=16*i,s=1*i/78*e.length|0,f=1*(i+1)/78*e.length|0,l=0,d=0,u=0,c=0,a=s;a<f;a++)b=y(p,a),a>s&&(u>0?b<d&&(u=-1,c=1):u<0?b>d&&(u=-1,c=1):b>d?u=1:b<d&&(u=-1)),c&&(d<0&&(d=-d),(d=Math.sqrt(1.5*d))>1&&(d=1),++n[h+(c=15*d|0)]>l&&(l=n[h+c]),c=0),d=b;for(n[h+16-1]>n[h+16-2]&&(n[h+16-2]=n[h+16-1]),a=14;a>=0;a--)c=l?6*n[h+a]/l|0:0,n[h+a]=c}for(a=14;a>=0;a--){for(t="",i=0;i<78;i++)t+=" .+*xX#?"[n[16*i+a]];o(r,"%s",t+"\n")}L(r)}(y,n),u=E(),v=(a=se(y,0,0,0,n)).begin,m=a.end,b=a.find,a=a.result,f=E(),l=q(v,y.rate),c=q(m,y.rate),h=q(m-v,y.rate),s=function(e,r,t){var n,a=0;switch(t<30?a--:t>40&&a++,r<10?a++:r>20&&a--,e<14?a++:e>20&&a--,a){case 3:n="A+";break;case 2:n="A ";break;case 1:n="B ";break;case 0:n="C ";break;case-1:n="D ";break;case-2:n="E ";break;case-3:n="F ";break;default:n="? "}return n}(b,a,i=100*(m-v)/y.length),n&&(!function(e,r,t,n){var a,i,s,u;for(i=1*r/e.length*78+.5|0,s=1*t/e.length*78+.5|0,u="",a=0;a<78;a++)u+=a>i&&a<s?"$":a==i||a==s?"|":"-";o(n,"%s",u+="\n"),L(n)}(y,v,m,n),o(n,"Cut: %s - %s = -%s (-%s%%), diff = %s\n",l,c,h,i.toFixed(1),a.toFixed(3)),o(n,"Algorithm took %s sec. Your grade of quality: %s ...",(1*(f-u)/z).toFixed(2),s),L(n)),r||t?(d=ne(y,v,m,r,t),n&&(o(n," saving: %s!\n",d?"success":"ERROR"),L(n))):n&&(o(n," done!\n"),L(n)),y.buffer=null,d)):(n&&(o(n,"Input file read error or invalid WAVE format!\n"),L(n)),!1)}function ue(e,r,t,n){var a,i,s,u,f;return i=0==d(f=(u=e+r)+".old"),s=0==y(u,f),(a=h(u,"w"))?(n&&(o(n,'%s: "%s" ',t,u),s?o(n,i?"[%s replaced]\n":"[%s renamed]\n",".old"):o(n,"\n"),L(n)),u=null,f=null,a):(s&&y(f,u),n&&(o(n,'%s "%s" open error!\n',t,u),L(n)),null)}function fe(e,r,n,a){if(!t)return 0;var u="=== Press ENTER to exit ===";return e?(r&&-1!=r&&i(r),n&&i(n),a&&i(a),o(s,"%s",u),L(s),2!=e&&(o(m,"%s",u),L(m)),process.stdin.resume(),process.stdin.setEncoding("ascii"),process.stdin.on("data",function(e){e.indexOf("\n")>=0&&process.exit()}),-1):-1}function le(e,r){var t,n=0,a=null,i=null,u=null,f=m;if(I)return _("This program must be compiled for little-endian 32bit platform only!\n"),0;if(n=e<3,e<2||e>4)return _("RepeatRemove v1.2, by Kly_Men_COmpany!  (License: WTFPL)  Usage:\n"),_('  repeat_remove "in.wav" "out.wav" "loop.wav"   [general mode, full control]\n'),_('  repeat_remove "in.wav" "out.wav"   [skipping debug loop output]\n'),_('  repeat_remove "in.wav"   [assumed "in.wav.out.wav" and "in.wav.loop.wav"]\n'),_('  repeat_remove - <"in.wav"   [outputs are ignored, logging-only mode]\n'),_('  repeat_remove - - <"in.wav" >"out.wav"   [piping mode, no loop output]\n'),_('  repeat_remove - - - <"in.wav" >"out.wav" 2>"loop.wav"   [no stderr logging]\n'),_("Supports one file Shell drag-and-drop. Piping MP3 via LAME or FLAC via FFMPEG:\n"),_("  lame --decode in.mp3 - | repeat_remove - - | lame --preset extreme - out.mp3\n"),_("  ffmpeg -i in.flac -f wav - | repeat_remove - - | ffmpeg -y -i - out.flac\n"),_('This program will process WAVE music file - to find there a "repeat".\n'),_("That's a loop of the exact same moment, repeated twice or more.\n"),_("You will have another .wav output file without that loop (precisely cut),\n"),_("and optionally the loop itself, with swapped halves (so you could examine it).\n"),_("To work properly, this program implies some rules. Make sure that:\n"),_(" 1) Your file actually has the repeat! Otherwise, an output will be broken;\n"),_(" 2) The length of the intro before the loop, and the finale after -\n"),_("    are not larger than one repeat length. So, the looped part should be big;\n"),_(" 3) Wave file has more than 5000 samples, but also not larger than 200-450 Mb;\n"),_(" 4) Your file contains real music: not a complete silence, noise or signals.\n"),_("If you have three or more loops, be prepared to invoke this program\n"),_("several times, manually checking the quality of intermediate cuttings.\n"),fe(2,a,i,u);if(e>1&&"-"==r[1]&&(a=-1,n=!1),e>2&&"-"==r[2]&&(i=s),e>3&&"-"==r[3]&&(i?(u=m,f=null):u=s),f&&(o(f,"\nRepeatRemove v1.2!\n"),o(f,'%s: "%s"\n',"Source",a?"<stdin>":r[1]),L(f)),!a){if(!(a=h(r[1],"r")))return f&&o(f,"Input file open error!\n"),fe(n,a,i,u);if(e<3&&((i=ue(r[1],".out.wav","Output",f))&&(u=ue(r[1],".loop.wav","Repeat",f)),!u||!i))return fe(n,a,i,u)}if(!i&&e>2){if(!(i=ue(r[2],"","Output",f)))return fe(n,a,i,u)}else i&&i!=s||f&&(o(f,'%s: "%s"\n',"Output",i?"<stdout>":"<null>"),L(f));if(!u&&e>3){if(!(u=ue(r[3],"","Repeat",f)))return fe(n,a,i,u)}else u&&u!=s||f&&(o(f,'%s: "%s"\n',"Repeat",u?"<stdout>":"<null>"),L(f));return t=oe(a,i,u,f),fe(n,a,i,u),t?0:-1}if(t)return le;function ce(){l=0,c=[],p=null,k=!1}var he=function(e){switch(e.data.action){case"start":ce();var t=e.data.url;if(!t){try{var n=le(1,[""]),a=function(){r({action:"done",res:null})};n.then?n.then(a).catch(function(e){if(ce(),"abort"!=e)throw e}):a()}catch(e){throw ce(),e}return}!function(e,r){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="blob",t.onload=function(e){if(200==t.status){var n=new FileReader;n.onload=function(e){r(e.target.result)},n.readAsArrayBuffer(t.response)}},t.send()}(t,function(t){p=t;try{var n=le(2,["",e.data.name||"-"]),a=function(){var e=c.map(function(e){return{blob:URL.createObjectURL(e.blob),name:e.name}});r({action:"done",res:e}),ce()};n.then?n.then(a).catch(function(e){if(ce(),"abort"!=e)throw e}):a()}catch(e){throw ce(),e}});break;case"abort":k=!0}};n?window.repeat_remove=function(e,t){t&&(r=function(e){k||t({data:e})}),he({data:e})}:(self.onmessage=he,r=self.postMessage)}}();
//EOF