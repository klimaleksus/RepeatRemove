// /nodejs/legacy/repeat_remove.js
"use strict";function asyncGeneratorStep(e,r,t,n,a,u,s){try{var i=e[u](s),o=i.value}catch(e){return void t(e)}i.done?r(o):Promise.resolve(o).then(n,a)}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise(function(n,a){var u=e.apply(r,t);function s(e){asyncGeneratorStep(u,n,a,s,i,"next",e)}function i(e){asyncGeneratorStep(u,n,a,s,i,"throw",e)}s(void 0)})}}!function(){var e,r,t=!0,n=!1,a="NodeJS";if("undefined"==typeof module||module.parent)t=!1,self!=self.window?(a="WebWorkers",self.importScripts("./buffer.js"),self.Buffer=self.buffer.Buffer,o()):self.window&&(n=!0,a="Browser",window.Buffer=window.buffer.Buffer,o());else{e=require("fs"),require("util");for(var u,s=[],i=1;i<process.argv.length;i++)s.push(process.argv[i]);u=s.length,process.exitCode=o()(u,s)}function o(){if(t){o=function(r,t,n,a){try{return e.readSync(a,r,0,t*n,null)/t|0}catch(e){return 0}},p=function(r,t,n,a){try{return e.writeSync(a,r,0,t*n,null)/t|0}catch(e){return 0}},b=function(r,t){try{return e.openSync(r,t)}catch(e){return null}};var u=function(r){try{return e.closeSync(r),0}catch(e){return-1}};h=function(r){try{return e.unlinkSync(r),0}catch(e){return 1}},d=function(r,t){try{return e.renameSync(r,t),0}catch(e){return 1}},y=function(e){try{return Buffer.allocUnsafeSlow(e)}catch(e){return null}},m=0,s=1,v=2,i=function(){var e=Array.prototype.slice.call(arguments),r=e.shift(),t=x.apply(null,e),n=Buffer.from(t,"utf8");return p(n,1,n.length,r)}}else var s,i=function(e){var r=Array.prototype.slice.call(arguments);r.shift();e(x.apply(null,r))},o=function(e,r,t,n){n=m;for(var a=Math.min(n.byteLength,r*t),u=new Uint8Array(n),s=0;s<a;s++)e[s]=u[s];return m=n.slice(a),a/r|0},f=function(e,r){(!r||r<0||r>m.byteLength)&&(r=m.byteLength);try{e.buffer=Buffer.from(m,m.byteOffset,r),e.bytes=r}catch(r){e.bytes=0,e.buffer=null}},c=0,l=[],b=function(e,r){if(c>2)return null;if(!c++)return m;var t={blob:new Blob([""],{type:"audio/wav"}),size:0,name:e};return l.push(t),t},p=function(e,r,t,n){var a=Math.min(e.byteLength,r*t);return n.blob=new Blob([n.blob,e.slice(0,a)],{type:"audio/wav"}),n.size+=a,a/r|0},h=function(e){return 1},d=function(e){return 1},y=function(e){try{return Buffer.alloc(e)}catch(e){return null}},m=null,v=s=function(e){r({action:"log",text:e})};function x(){var e=Array.prototype.slice.call(arguments),r=""+e.shift(),t=0;return r.replace(/%./g,function(r){if(t>=e.length)return r;switch(r){case"%d":return+e[t++];case"%s":return""+e[t++];case"%%":return"%";default:return r}})}var w=function(e,r,t){return r.copy(e,0,0,t),e},k=i.bind(null,s),g=function(e){},_=!1;n&&window.Promise&&(g=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!_){e.next=2;break}throw"abort";case 2:return e.next=4,new Promise(function(e){setTimeout(e)});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(r){return e.apply(this,arguments)}}());var R=1e3;function L(){return Date.now()}function z(e,r,t,n){var a=""+e;if(a.length>=r)return a;var u=t.repeat(r-a.length);return n?a+u:u+a}var E=!0;try{var A=new ArrayBuffer(2),I=new Uint16Array(A,0,1),T=new Uint8Array(A,0,2);T[0]=0,I[0]=1,T[0]&&(E=!1)}catch(e){}function S(e,r,t){for(var n,a=0;t>0&&!((n=o(r,1,t,e))<0)&&(n||1==(n=o(r,1,1,e)));)a+=n,r=r.slice(n),t-=n;return a}function O(e,r,t){for(var n,a=0;t>0&&!((n=p(r,1,t,e))<0)&&(n||1==(n=p(r,1,1,e)));)a+=n,r=r.slice(n),t-=n;return a}function F(e,r){var t=void 0===r;switch(e){case"riff_header":return t?this.slice(0).toString("binary",0,4):this.slice(0).write(r,0,4,"binary");case"wav_size":return t?this.readInt32LE(4):this.writeInt32LE(r,4);case"wave_header":return t?this.slice(8).toString("binary",0,4):this.slice(8).write(r,0,4,"binary");case"fmt_header":return t?this.slice(12).toString("binary",0,4):this.slice(12).write(r,0,4,"binary");case"fmt_chunk_size":return t?this.readInt32LE(16):this.writeInt32LE(r,16);case"audio_format":return t?this.readInt16LE(20):this.writeInt16LE(r,20);case"num_channels":return t?this.readInt16LE(22):this.writeInt16LE(r,22);case"sample_rate":return t?this.readInt32LE(24):this.writeInt32LE(r,24);case"byte_rate":return t?this.readInt32LE(28):this.writeInt32LE(r,28);case"sample_alignment":return t?this.readInt16LE(32):this.writeInt16LE(r,32);case"bit_depth":return t?this.readInt16LE(34):this.writeInt16LE(r,34);case"data_header":return t?this.slice(36).toString("binary",0,4):this.slice(36).write(r,0,4,"binary");case"data_bytes":return t?this.readInt32LE(40):this.writeInt32LE(r,40)}return null}function G(e){switch(e){case"riff_header":return 0;case"wav_size":return 4;case"wave_header":return 8;case"fmt_header":return 12;case"fmt_chunk_size":return 16;case"audio_format":return 20;case"num_channels":return 22;case"sample_rate":return 24;case"byte_rate":return 28;case"sample_alignment":return 32;case"bit_depth":return 34;case"data_header":return 36;case"data_bytes":return 40}return-1}function B(e){switch(e){case"wave_header":return 44;case"uint":case"float":return 4}return 0}function M(e,r,t,n){var a,u=B("wave_header")-(t.byteOffset-r.byteOffset);return!!(a=y(n))&&(S(e,a,n)!=n?(a=null,!1):(n<u?(w(t,t.slice(n),u-n),w(t.slice(u-n),a,n)):w(t,a.slice(n-u),u),a=null,!0))}function U(e,r){var t;if(S(r,e,B("wave_header"))!=B("wave_header"))return!1;var n=e;if("RIFF"!=(e=F.bind(e))("riff_header"))return!1;if("WAVE"!=e("wave_header"))return!1;for(;"fmt "!=e("fmt_header");){if((t=e("fmt_chunk_size"))<0||t>1048576)return!1;if(1&t&&t++,t+=8,!M(r,n,n.slice(G("fmt_header")),t))return!1}for(;"data"!=e("data_header");){if((t=e("data_bytes"))<0||t>1048576)return!1;if(1&t&&t++,t+=8,!M(r,n,n.slice(G("data_header")),t))return!1}return!0}function P(e,r,t,n,a){var u={};return!((e=F.bind(e))("wav_size")>0&&e("data_bytes")>0&&e("wav_size")<e("data_bytes"))&&(16==e("fmt_chunk_size")&&(1==e("audio_format")&&((1==e("num_channels")||2==e("num_channels"))&&((8==e("bit_depth")||16==e("bit_depth"))&&(r&&(u.is_stereo=2==e("num_channels")),t&&(u.is_16bit=16==e("bit_depth")),n&&(u.sample_rate=e("sample_rate")),a&&(e("data_bytes")>0&&e("data_bytes")<2147483647?u.data_bytes=e("data_bytes"):u.data_bytes=-1),u)))))}function W(e,r){var t,n=P(e,!0,!0,null,null);return n?(t=r,n.is_stereo&&(t<<=1),n.is_16bit&&(t<<=1),(e=F.bind(e))("data_bytes",t),e("wav_size",t+B("wave_header")-8),1&e("wav_size")&&e("wav_size",e("wav_size")+1),t):-1}function q(e){var r,t,n=e.bytes;if(n<2048)return!1;for(n&=-2,n-=12,r=e.buffer,t=0;t<1024;t+=2){if("RIFF"==r.slice(n).toString("binary",0,4)&&"WAVE"==r.slice(n+8).toString("binary",0,4))return e.bytes=n,!0;n-=2}return!1}function V(e,r){var t=e/r|0,n=e%r*1/r*1e5|0;return x("%d:%s.%s",t/60|0,z(t=t%60|0,2,"0",!1),z(n,5,"0",!1))}function C(e,r){var t,n,a,u,s,i,o,f,c={};for((t=[]).length=256,n=0,u=0;u<256&&(t[u]=y(8388608),t[u])&&(s=8388608,n+=i=S(e,t[u],s),8388608==i);u++);if(!(o=y(n))){for(c.buffer=null,u=0;u<256&&t[u];u++)t[u]=null;return t=null,c.result=-n,c}for(c.buffer=o,a=n,u=0;u<256&&(f=t[u]);u++)s=8388608,n<8388608&&(s=n),w(o,f,s),o=o.slice(s),t[u]=null,n-=s;return t=null,c.result=a,c}function N(e,r,t){return Y.apply(this,arguments)}function Y(){return(Y=_asyncToGenerator(regeneratorRuntime.mark(function e(r,n,a){var u,s,o,c,l,b,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=P(r.header,!0,!0,!0,!0)){e.next=7;break}if(!a){e.next=6;break}return i(a,"Your WAVE is not supported!\n"),e.next=6,g(a);case 6:return e.abrupt("return",!1);case 7:if(s=l.is_stereo,o=l.is_16bit,r.rate=l.sample_rate,u=l.data_bytes,!a){e.next=15;break}return i(a,"WAVE: %d bit %s (%d Hz),",o?16:8,s?"stereo":"mono",r.rate),e.next=15,g(a);case 15:if(!(u>0)){e.next=35;break}if(!t){e.next=27;break}if(r.buffer=y(u),r.buffer){e.next=24;break}if(!a){e.next=23;break}return i(a,"\nOut of memory! (Need %d Mb)\n",u>>20),e.next=23,g(a);case 23:return e.abrupt("return",!1);case 24:r.bytes=S(n,r.buffer,u),e.next=28;break;case 27:f(r,u);case 28:if(r.bytes==u){e.next=33;break}if(!a){e.next=33;break}return i(a,"\nProbably a read error (size should be %d)...\n",u),e.next=33,g(a);case 33:e.next=46;break;case 35:if(!a){e.next=39;break}return i(a,"\nBad size in RIFF header..."),e.next=39,g(a);case 39:if(t?(b=C(n,r.buffer),r.bytes=b.result,r.buffer=b.buffer):f(r),!(r.bytes<0)){e.next=46;break}if(!a){e.next=45;break}return i(a,"\nOut of memory! (Need 2*%d Mb)\n",-r.bytes),e.next=45,g(a);case 45:return e.abrupt("return",!1);case 46:if(!q(r)){e.next=51;break}if(!a){e.next=51;break}return i(a,"\nIgnored extra RIFF tail..."),e.next=51,g(a);case 51:if(p=r.buffer,s?o?(r.bytes=-4&r.bytes,r.length=r.bytes>>2,r.shift=2,r.array=new Int16Array(p.buffer,p.byteOffset,p.byteLength/2),r.based=new Uint32Array(p.buffer,p.byteOffset,p.byteLength/4)):(r.bytes=-2&r.bytes,r.length=r.bytes>>1,r.shift=1,r.array=new Uint8Array(p.buffer,p.byteOffset,p.byteLength),r.based=new Uint16Array(p.buffer,p.byteOffset,p.byteLength/2)):o?(r.bytes=-2&r.bytes,r.length=r.bytes>>1,r.shift=5,r.array=new Int16Array(p.buffer,p.byteOffset,p.byteLength/2),r.based=new Uint16Array(p.buffer,p.byteOffset,p.byteLength/2)):(r.length=r.bytes,r.shift=0,r.array=new Uint8Array(p.buffer,p.byteOffset,p.byteLength),r.based=new Uint8Array(p.buffer,p.byteOffset,p.byteLength)),c=V(r.length,r.rate),!a){e.next=58;break}return i(a," bytes: %d, length: %s\n",r.bytes,c),e.next=58,g(a);case 58:return e.abrupt("return",!0);case 59:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(e,r,t,n){return j.apply(this,arguments)}function j(){return(j=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,a){var u,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((u=Buffer.alloc(4))[0]=0,s=3&r.shift,!((i=W(r.header,a))<1)){e.next=6;break}return e.abrupt("return",!1);case 6:if(a<<=s,n<<=s,O(t,r.header,B("wave_header"))==B("wave_header")){e.next=10;break}return e.abrupt("return",!1);case 10:if(O(t,r.buffer.slice(n),a)==a){e.next=12;break}return e.abrupt("return",!1);case 12:return 1&i&&O(t,u,1),e.next=15,g(t);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(e,r,t,n){var a,u,s,i,o;if(r<1||t<1)return 0;if(o=1,s=0,n){if(e[s++]=1,1==r||1==t)return 1;o=2}for(e[s++]=2,a=3;a<=t&&s<r;a+=2){for(e[s]=a,i=0|Math.sqrt(a),u=o;u<s&&e[u]<=i;u++)if(a%e[u]==0){s--;break}s++}return s}function X(e,r){var t=e[r<<=1];return((t>0?t/32767:t/32768)+((t=e[r+1])>0?t/32767:t/32768))/2}function J(e,r){var t=e[r<<=1]-128;return((t>0?t/127:t/128)+((t=e[r+1]-128)>0?t/127:t/128))/2}function K(e,r){var t=e[r];return t>0?t/32767:t/32768}function Z(e,r){var t=e[r]-128;return t>0?t/127:t/128}function $(e,r){return Q.apply(this,arguments)}function Q(){return(Q=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t){var n,a,u,s,o,f,c,l,b,p,h,d,y,m,v,x,w,k,_;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=78,a=16,(u=[]).length=1248,s=0;s<u.length;s++)u[s]=0;f=6,c=" .+*xX#?",w=r.shift,k=r.array,e.t0=w,e.next=0===e.t0?12:1===e.t0?14:2===e.t0?16:18;break;case 12:return _=Z,e.abrupt("break",20);case 14:return _=J,e.abrupt("break",20);case 16:return _=X,e.abrupt("break",20);case 18:return _=K,e.abrupt("break",20);case 20:for(l=0;l<n;l++){for(m=l*a,b=1*l/n*r.length|0,h=1*(l+1)/n*r.length|0,d=0,x=0,p=0,y=0,s=b;s<h;s++)v=_(k,s),s>b&&(p>0?v<x&&(p=-1,y=1):p<0?v>x&&(p=-1,y=1):v>x?p=1:v<x&&(p=-1)),y&&(x<0&&(x=-x),(x=Math.sqrt(1.5*x))>1&&(x=1),++u[m+(y=x*(a-1)|0)]>d&&(d=u[m+y]),y=0),x=v;for(u[m+a-1]>u[m+a-2]&&(u[m+a-2]=u[m+a-1]),s=a-2;s>=0;s--)y=d?u[m+s]*f/d|0:0,u[m+s]=y}for(s=a-2;s>=0;s--){for(o="",l=0;l<n;l++)o+=c[u[l*a+s]];i(t,"%s",o+"\n")}return e.next=24,g(t);case 24:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ee(e,r){return r<1?0:100*Math.sqrt(e/r)}function re(e,r,t){var n,a,u;return a=(n=e[r<<=1])>0?n/32767:n/32768,u=(n=e[r+1])>0?n/32767:n/32768,(a-=(n=e[t<<=1])>0?n/32767:n/32768)*a+(u-=(n=e[t+1])>0?n/32767:n/32768)*u}function te(e,r,t){var n,a,u;return a=(n=e[r<<=1]-128)>0?n/127:n/128,u=(n=e[r+1]-128)>0?n/127:n/128,(a-=(n=e[t<<=1]-128)>0?n/127:n/128)*a+(u-=(n=e[t+1]-128)>0?n/127:n/128)*u}function ne(e,r,t){var n,a;return a=(n=e[r])>0?n/32767:n/32768,(a-=(n=e[t])>0?n/32767:n/32768)*a}function ae(e,r,t){var n,a;return a=(n=e[r]-128)>0?n/127:n/128,(a-=(n=e[t]-128)>0?n/127:n/128)*a}function ue(e,r,t,n,a){var u,s,i=e.array,o=0;if(a<1)return o;switch(e.shift){case 0:s=ae;break;case 1:s=te;break;case 2:s=re;break;default:s=ne}if(n>0)for(u=0;u<n;u+=a)o+=s(i,r+u,t+u);else for(u=0;u>n;u-=a)o+=s(i,r+u,t+u);return o}function se(e,r){var t,n,a;return(n=(t=e[r<<=1])>0?t/32767:t/32768)*n+(a=(t=e[r+1])>0?t/32767:t/32768)*a}function ie(e,r){var t,n,a;return(n=(t=e[r<<=1]-128)>0?t/127:t/128)*n+(a=(t=e[r+1]-128)>0?t/127:t/128)*a}function oe(e,r){var t,n;return(n=(t=e[r])>0?t/32767:t/32768)*n}function fe(e,r){var t,n;return(n=(t=e[r]-128)>0?t/127:t/128)*n}function ce(e,r,t){var n,a,u,s=e.array,i=-1,o=0;switch(e.shift){case 0:u=fe;break;case 1:u=ie;break;case 2:u=se;break;default:u=oe}for(a=-r;a<=r;a++)((n=u(s,t+a))<i||i<0)&&(i=n,o=a);return o}function le(e,r,t){for(var n,a=e.length,u=a/1e3|0,s=r,i=r+t,o=0,f=0,c=-1,l=-1;o+f<t;)if(c<0&&s-(o+u)>0&&(c=ue(e,s-(o+u),i-(o+u),u,1)),l<0&&i+(f+u)<a&&(l=ue(e,s+f,i+f,u,1)),c>=0&&(c<l||l<0))o+=u,c=-1;else{if(!(l>=0))break;f+=u,l=-1}return(n=o+f-t)<2?s-o:s-(o-(n>>1))}function be(e,r,t){var n,a,u,s,i,o,f=e.based;if(!(t<2))if(u=r,s=r+(n=t>>1),1&t){for(o=f[t-1],a=0;a<n;a++)i=f[u],f[u]=f[s],f[s]=o,o=i,u++,s++;f[t-1]=o}else for(a=0;a<n;a++)i=f[u],f[u]=f[s],f[s]=i,u++,s++}function pe(e,r,t,n){var a=3&e.shift;r<<=a,t<<=a,n<<=a,w(e.buffer.slice(n),e.buffer.slice(r),t)}function he(e,r,t,n,a){return de.apply(this,arguments)}function de(){return(de=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,a,u){var s,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.length,i=n-t,o=!0,!u){e.next=9;break}return be(r,t,i),e.next=7,D(r,u,t,i);case 7:if(e.sent){e.next=9;break}o=!1;case 9:if(!a){e.next=15;break}return pe(r,n,s-n,t),e.next=13,D(r,a,0,s-i);case 13:if(e.sent){e.next=15;break}o=!1;case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ye(e,r,t,n,a,u,s){var i,o,f,c,l,b,p,h,d,y,m=e.length,v=a,x=-1,w=0;for(f=m/10|0,s?(o=r-((m/5|0)-(m/1e3|0)),(i=r-((m/2|0)+(m/1e3|0)))-f<0&&(i=f),f=-f):(i=r+((m/5|0)-(m/1e3|0)),(o=r+((m/2|0)+(m/1e3|0)))+f>m&&(o=m-f)),y=i;y<o;y++)v[w++]=y;for(d=n-1;w>1;){for(h=t[d],l=0,y=0;y<w;y++)l+=c=ue(e,r,v[y],f,h),(c<x||!y)&&(x=c),u[y]=c;for(b=x+.75*(l/w-x),p=0,y=0;y<w;y++)u[y]<=b&&(v[p++]=v[y]);if(w=p,!d)break;d>>=1}return s?r-v[0]:v[0]-r}function me(e,r,t){var n;for(n=e[0].from;n>0;n--)if(e[n].from==r){r=-1;break}for(r>=0&&(e[++e[0].from].from=r),n=e[0].size;n>0;n--)if(e[n].size==t){t=-1;break}t>=0&&(e[++e[0].size].size=t)}function ve(e,r,t,n,a,u){return xe.apply(this,arguments)}function xe(){return(xe=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,a,u,s){var o,f,c,l,b,p,h,d,y,m,v,x,w,k,_,R;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o={},l=t[0].from,b=t[0].size,m=r.length/2e3|0,w=0,k=0,f=1;f<=l;f++)t[f].from+=ce(r,m,t[f].from);for(f=1;f<=l;f++)for(c=f+1;c<=l;c++)t[f].from>t[c].from&&(p=t[f].from,t[f].from=t[c].from,t[c].from=p);for(f=1;f<=b;f++)for(c=f+1;c<=b;c++)t[f].size>t[c].size&&(p=t[f].size,t[f].size=t[c].size,t[c].size=p);for(c=1,f=2;f<=l;f++)t[f].from!=t[c].from&&(t[++c].from=t[f].from);for(l=c,t[0].from=c,c=1,f=2;f<=b;f++)t[f].size!=t[c].size&&(t[++c].size=t[f].size);if(b=c,t[0].size=c,!s){e.next=21;break}return i(s,"Refining: %s x %s...  ",z(l,2," ",!1),z(b,2," ",!0)),e.next=21,g(s);case 21:o.find=l+b,x=-1,c=1;case 24:if(!(c<=b)){e.next=44;break}if(!s){e.next=28;break}return e.next=28,g(s);case 28:y=t[c].size,h=y/3|0,f=1;case 31:if(!(f<=l)){e.next=41;break}if(!((d=t[f].from)-h<0||d+y+h>=r.length)){e.next=35;break}return e.abrupt("continue",38);case 35:((v=ee(v=ue(r,d-h,d+y-h,2*h,1),2*h))<x||x<0)&&(w=d,k=y,x=v);case 38:f++,e.next=31;break;case 41:c++,e.next=24;break;case 44:if(!s){e.next=48;break}return i(s,"START: %s ",z(w,10," ",!0)),e.next=48,g(s);case 48:for(x=-1,f=-10;f<=10;f++)R=(d=w)+(y=k+f)+(h=(y>>1)-20),(_=d-h)<0?_=0:R>=r.length&&(_-=R+1-r.length),((v=ee(v=ue(r,_,_+y,2*h,1),2*h))<x||x<0)&&(x=v,o.begin=d,o.end=d+y);if(!s){e.next=54;break}return i(s,"END: %s SIZE: %s\n",z(o.end,10," ",!0),z(o.end-o.begin,10," ",!0)),e.next=54,g(s);case 54:return o.result=x,e.abrupt("return",o);case 56:case"end":return e.stop()}},e)}))).apply(this,arguments)}function we(e,r,t,n,a){return ke.apply(this,arguments)}function ke(){return(ke=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,u,s){var o,f,c,l,b,p,h,d,y,m,v,x,w,k,_,R,L,E,A;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r.length,b=o/8|0,p=o/2|0,h=o/16|0,L=o/2|0,(E=[]).length=16,A=0;A<E.length;A++)E[A]={from:0,size:0};if(R=(I=L)<2?2:1.25506*I/Math.log(I)+1|0,w=new Uint32Array(L),k=new Float32Array(L),_=new Uint32Array(R),x=B("uint")*L+B("float")*L+B("uint")*R+r.bytes,R=H(_,L,o/40|0,!0),!s){e.next=18;break}return i(s,"Total samples: %d, memory used: %d Mb, environment: %s\n",o,1*x/1048576+.5|0,a),e.next=18,g(s);case 18:v=0,d=b;case 20:if(!(d<=p)){e.next=41;break}m=0;case 22:if(!(m<=1)){e.next=38;break}if(v++,f=(y=m?o-d:d)+ce(r,o/2e3|0,y),c=ye(r,f,_,R,w,k,m),m&&(f-=c),l=le(r,f,c),me(E,l+(c>>1),c),!s){e.next=35;break}return i(s,"%s%s",z(c,10," ",!1),v%7?" ":"\n"),e.next=35,g(s);case 35:m++,e.next=22;break;case 38:d+=h,e.next=20;break;case 41:return _=null,w=null,k=null,e.next=46,ve(r,E,t,n,u,s);case 46:return e.abrupt("return",e.sent);case 47:case"end":return e.stop()}var I},e)}))).apply(this,arguments)}function ge(e,r,t,n){return _e.apply(this,arguments)}function _e(){return(_e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,a){var u,s,o,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(78,s=1*t/r.length*78+.5|0,o=1*n/r.length*78+.5|0,f="",u=0;u<78;u++)f+=u>s&&u<o?"$":u==s||u==o?"|":"-";return i(a,"%s",f+="\n"),e.next=9,g(a);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Re(e,r,t){var n,a=0;switch(t<30?a--:t>40&&a++,r<10?a++:r>20&&a--,e<14?a++:e>20&&a--,a){case 3:n="A+";break;case 2:n="A ";break;case 1:n="B ";break;case 0:n="C ";break;case-1:n="D ";break;case-2:n="E ";break;case-3:n="F ";break;default:n="? "}return n}function Le(e,r,t,n){return ze.apply(this,arguments)}function ze(){return(ze=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,a){var u,s,o,f,c,l,b,p,h,d,y,v,x;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===r&&(r=m),o=!0,c=!0,l={header:Buffer.alloc(B("wave_header")),buffer:null,length:0,bytes:0,shift:0,rate:0,array:null,based:null},h=!0,d=!0,U(l.header,r)){e.next=12;break}if(!a){e.next=11;break}return i(a,"Input file read error or invalid WAVE format!\n"),e.next=11,g(a);case 11:return e.abrupt("return",!1);case 12:return e.next=14,N(l,r,a);case 14:if(e.sent){e.next=16;break}return e.abrupt("return",!1);case 16:if(!(l.length<5e3)){e.next=22;break}if(!a){e.next=21;break}return i(a,"The file is too small!\n"),e.next=21,g(a);case 21:return e.abrupt("return",!1);case 22:if(!a){e.next=25;break}return e.next=25,$(l,a);case 25:return b=L(),e.next=28,we(l,h,d,o,a);case 28:if(u=e.sent,h=u.begin,d=u.end,o=u.find,u=u.result,p=L(),y=V(h,l.rate),v=V(d,l.rate),x=V(d-h,l.rate),s=100*(d-h)/l.length,f=Re(o,u,s),!a){e.next=46;break}return e.next=42,ge(l,h,d,a);case 42:return i(a,"Cut: %s - %s = -%s (-%s%%), diff = %s\n",y,v,x,s.toFixed(1),u.toFixed(3)),i(a,"Algorithm took %s sec. Your grade of quality: %s ...",(1*(p-b)/R).toFixed(2),f),e.next=46,g(a);case 46:if(!t&&!n){e.next=56;break}return e.next=49,he(l,h,d,t,n);case 49:if(c=e.sent,!a){e.next=54;break}return i(a," saving: %s!\n",c?"success":"ERROR"),e.next=54,g(a);case 54:e.next=60;break;case 56:if(!a){e.next=60;break}return i(a," done!\n"),e.next=60,g(a);case 60:return l.buffer=null,e.abrupt("return",c);case 62:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ee(e,r,t,n){return Ae.apply(this,arguments)}function Ae(){return(Ae=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,a){var u,s,o,f,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=0==h(l=(c=r+t)+(s=".old")),f=0==d(c,l),u=b(c,"w")){e.next=13;break}if(f&&d(l,c),!a){e.next=12;break}return i(a,'%s "%s" open error!\n',n,c),e.next=12,g(a);case 12:return e.abrupt("return",null);case 13:if(!a){e.next=18;break}return i(a,'%s: "%s" ',n,c),f?i(a,o?"[%s replaced]\n":"[%s renamed]\n",s):i(a,"\n"),e.next=18,g(a);case 18:return c=null,l=null,e.abrupt("return",u);case 21:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ie(e,r,t,n){return Te.apply(this,arguments)}function Te(){return(Te=_asyncToGenerator(regeneratorRuntime.mark(function e(r,n,a,o){var f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",0);case 2:if(f="=== Press ENTER to exit ===",r){e.next=5;break}return e.abrupt("return",-1);case 5:return n&&-1!=n&&u(n),a&&u(a),o&&u(o),i(s,"%s",f),e.next=11,g(s);case 11:if(2==r){e.next=15;break}return i(v,"%s",f),e.next=15,g(v);case 15:return process.stdin.resume(),process.stdin.setEncoding("ascii"),process.stdin.on("data",function(e){e.indexOf("\n")>=0&&process.exit()}),e.abrupt("return",-1);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Se(e,r){return Oe.apply(this,arguments)}function Oe(){return(Oe=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t){var n,a,u,o,f,c,l,p,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=0,u="Source",o="Output",f="Repeat",c=null,l=null,p=null,h=v,!E){e.next=11;break}return k("This program must be compiled for little-endian 32bit platform only!\n"),e.abrupt("return",0);case 11:if(n=r<3,!(r<2||r>4)){e.next=38;break}return k("RepeatRemove v1.2, by Kly_Men_COmpany!  (License: WTFPL)  Usage:\n"),k('  repeat_remove "in.wav" "out.wav" "loop.wav"   [general mode, full control]\n'),k('  repeat_remove "in.wav" "out.wav"   [skipping debug loop output]\n'),k('  repeat_remove "in.wav"   [assumed "in.wav.out.wav" and "in.wav.loop.wav"]\n'),k('  repeat_remove - <"in.wav"   [outputs are ignored, logging-only mode]\n'),k('  repeat_remove - - <"in.wav" >"out.wav"   [piping mode, no loop output]\n'),k('  repeat_remove - - - <"in.wav" >"out.wav" 2>"loop.wav"   [no stderr logging]\n'),k("Supports one file Shell drag-and-drop. Piping MP3 via LAME or FLAC via FFMPEG:\n"),k("  lame --decode in.mp3 - | repeat_remove - - | lame --preset extreme - out.mp3\n"),k("  ffmpeg -i in.flac -f wav - | repeat_remove - - | ffmpeg -y -i - out.flac\n"),k('This program will process WAVE music file - to find there a "repeat".\n'),k("That's a loop of the exact same moment, repeated twice or more.\n"),k("You will have another .wav output file without that loop (precisely cut),\n"),k("and optionally the loop itself, with swapped halves (so you could examine it).\n"),k("To work properly, this program implies some rules. Make sure that:\n"),k(" 1) Your file actually has the repeat! Otherwise, an output will be broken;\n"),k(" 2) The length of the intro before the loop, and the finale after -\n"),k("    are not larger than one repeat length. So, the looped part should be big;\n"),k(" 3) Wave file has more than 5000 samples, but also not larger than 200-450 Mb;\n"),k(" 4) Your file contains real music: not a complete silence, noise or signals.\n"),k("If you have three or more loops, be prepared to invoke this program\n"),k("several times, manually checking the quality of intermediate cuttings.\n"),e.next=37,Ie(2,c,l,p);case 37:return e.abrupt("return",e.sent);case 38:if(r>1&&"-"==t[1]&&(c=-1,n=!1),r>2&&"-"==t[2]&&(l=s),r>3&&"-"==t[3]&&(l?(p=v,h=null):p=s),!h){e.next=46;break}return i(h,"\nRepeatRemove v1.2!\n"),i(h,'%s: "%s"\n',u,c?"<stdin>":t[1]),e.next=46,g(h);case 46:if(c){e.next=65;break}if(c=b(t[1],"r")){e.next=53;break}return h&&i(h,"Input file open error!\n"),e.next=52,Ie(n,c,l,p);case 52:return e.abrupt("return",e.sent);case 53:if(!(r<3)){e.next=65;break}return e.next=56,Ee(t[1],".out.wav",o,h);case 56:if(!(l=e.sent)){e.next=61;break}return e.next=60,Ee(t[1],".loop.wav",f,h);case 60:p=e.sent;case 61:if(p&&l){e.next=65;break}return e.next=64,Ie(n,c,l,p);case 64:return e.abrupt("return",e.sent);case 65:if(l||!(r>2)){e.next=75;break}return e.next=68,Ee(t[2],"",o,h);case 68:if(l=e.sent){e.next=73;break}return e.next=72,Ie(n,c,l,p);case 72:return e.abrupt("return",e.sent);case 73:e.next=80;break;case 75:if(l&&l!=s){e.next=80;break}if(!h){e.next=80;break}return i(h,'%s: "%s"\n',o,l?"<stdout>":"<null>"),e.next=80,g(h);case 80:if(p||!(r>3)){e.next=90;break}return e.next=83,Ee(t[3],"",f,h);case 83:if(p=e.sent){e.next=88;break}return e.next=87,Ie(n,c,l,p);case 87:return e.abrupt("return",e.sent);case 88:e.next=95;break;case 90:if(p&&p!=s){e.next=95;break}if(!h){e.next=95;break}return i(h,'%s: "%s"\n',f,p?"<stdout>":"<null>"),e.next=95,g(h);case 95:return e.next=97,Le(c,l,p,h);case 97:return a=e.sent,Ie(n,c,l,p),e.abrupt("return",a?0:-1);case 100:case"end":return e.stop()}},e)}))).apply(this,arguments)}if(t)return Se;function Fe(){c=0,l=[],m=null,_=!1}var Ge=function(e){switch(e.data.action){case"start":Fe();var t=e.data.url;if(!t){try{var n=Se(1,[""]),a=function(){r({action:"done",res:null})};n.then?n.then(a).catch(function(e){if(Fe(),"abort"!=e)throw e}):a()}catch(e){throw Fe(),e}return}!function(e,r){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="blob",t.onload=function(e){if(200==t.status){var n=new FileReader;n.onload=function(e){r(e.target.result)},n.readAsArrayBuffer(t.response)}},t.send()}(t,function(t){m=t;try{var n=Se(2,["",e.data.name||"-"]),a=function(){var e=l.map(function(e){return{blob:URL.createObjectURL(e.blob),name:e.name}});r({action:"done",res:e}),Fe()};n.then?n.then(a).catch(function(e){if(Fe(),"abort"!=e)throw e}):a()}catch(e){throw Fe(),e}});break;case"abort":_=!0}};n?window.repeat_remove=function(e,t){t&&(r=function(e){_||t({data:e})}),Ge({data:e})}:(self.onmessage=Ge,r=self.postMessage)}}();
window.my_loaded_lib = true;
//EOF